# Nginx配置文件 - 将此配置添加到您的Nginx站点配置中
# 通常位于 /etc/nginx/sites-available/ 或 /etc/nginx/conf.d/

server {
    listen 80;
    server_name your-domain.com;  # 替换为您的域名
    root /path/to/your/docsify;   # 替换为您的项目路径
    index index.html;

    # 禁用缓存，防止304 Not Modified问题
    add_header Cache-Control "no-cache, no-store, must-revalidate" always;
    add_header Pragma "no-cache" always;
    add_header Expires 0 always;

    # 对markdown文件禁用缓存
    location ~* \.md$ {
        add_header Cache-Control "no-cache, no-store, must-revalidate" always;
        add_header Pragma "no-cache" always;
        add_header Expires 0 always;
        
        # 添加时间戳参数防止缓存
        expires -1;
        
        # 设置正确的MIME类型
        default_type text/plain;
        charset utf-8;
    }

    # 对PHP文件禁用缓存
    location ~* \.php$ {
        add_header Cache-Control "no-cache, no-store, must-revalidate" always;
        add_header Pragma "no-cache" always;
        add_header Expires 0 always;
        
        # 处理PHP文件
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;  # 根据您的PHP-FPM配置调整
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    # 对HTML文件禁用缓存
    location ~* \.html$ {
        add_header Cache-Control "no-cache, no-store, must-revalidate" always;
        add_header Pragma "no-cache" always;
        add_header Expires 0 always;
        expires -1;
    }

    # 静态资源缓存控制
    location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # 主要页面路由
    location / {
        try_files $uri $uri/ /index.html;
        
        # 禁用缓存
        add_header Cache-Control "no-cache, no-store, must-revalidate" always;
        add_header Pragma "no-cache" always;
        add_header Expires 0 always;
    }

    # 安全设置
    location ~ /\. {
        deny all;
    }

    # 限制上传文件大小
    client_max_body_size 10M;
}
